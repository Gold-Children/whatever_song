{% extends "base.html" %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'accounts/css/profile.css' %}">


<div id="profile-container">
    <div class="profile-image">
        <img id="profile-picture" alt="Profile Picture">
    </div>
    <p><span id="nickname"></span></p>
    <p class="hidden"><strong>Username:</strong> <span id="username"></span></p>
    <p class="hidden"><strong>Email:</strong> <span id="email"></span></p>
    <a href="/api/accounts/profile/{{user_id}}/edit/" id="edit-profile-button">프로필 수정</a>
</div>

<div class="menu">
    <a href="#" class="active">내 게시글 목록</a>
    <a href="#">찜한 게시글 목록</a>
    <a href="#">찜한 노래 목록</a>
    <a href="#">내가 받은 훈수</a>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const userId = '{{ user_id }}';  // 템플릿 태그를 사용해 현재 로그인한 유저의 ID를 가져옴
        console.log(userId)
        function loadProfile() {
            const token = localStorage.getItem('access');  // 저장된 토큰 가져오기
            if (!token) {
                console.error('No access token found');
                return;
            }
            axios.get(`/api/accounts/api/profile/${userId}/`,{
                headers: {
                    'Authorization': `Bearer ${token}`  // 인증 토큰을 헤더에 추가
                }
            })
                .then(response => {
                    const data = response.data;
                    document.getElementById('username').textContent = data.username;
                    document.getElementById('email').textContent = data.email;
                    document.getElementById('nickname').textContent = data.nickname;
                    if (data.image) {
                        document.getElementById('profile-picture').src = data.image;
                    }
                })
                .catch(error => {
                    console.error('Failed to load profile:', error);
                });
        }

        loadProfile();
        
        const menuLinks = document.querySelectorAll('.menu a');

        menuLinks.forEach(link => {
            link.addEventListener('click', function(event) {
                event.preventDefault();
                menuLinks.forEach(link => link.classList.remove('active'));
                this.classList.add('active');
            });
        });
    });
    
</script>
{% endblock content %}