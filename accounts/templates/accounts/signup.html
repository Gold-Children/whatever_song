{% extends "base.html" %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static 'accounts/css/signup.css' %}">
<div class="signup-form">
    <p>Signup</p>
    <form id="signup-form" method="post">
        <div class="signup">
            <span class="signup-text">아이디</span><input type="text" id="username" placeholder="아이디를 입력해주세요" required><br>
        </div>
        <div class="signup">
            <span class="signup-text">닉네임</span><input type="text" id="nickname" placeholder="닉네임을 입력해주세요" required><br>
        </div>
        <div class="signup">
            <span class="signup-text">비밀번호</span><input type="password" id="password" placeholder="비밀번호를 입력해주세요" required><br>
        </div>
        <div class="signup">
            <span class="signup-text">이메일</span><input type="email" id="email" placeholder="이메일을 입력해주세요" required><br>
        </div>
        <div class="signup-image-line">
            <span class="signup-text">사진</span>
            <span id="file-name">선택된 파일 없음</span>
            <label for="file-input" class="file-choice-btn">파일 선택</label>
            <input type="file" id="file-input" style="display:none;"><br>
        </div>
        <div class="signup-btn-line">
            <button type="submit">Signup</button>
        </div>
    </form>
</div>
<script>
    document.getElementById('signup-form').addEventListener('submit', function(e) {
        e.preventDefault();

        const formData = new FormData();
        formData.append('username', document.getElementById('username').value);
        formData.append('email', document.getElementById('email').value);
        formData.append('password', document.getElementById('password').value);
        formData.append('nickname', document.getElementById('nickname').value);
        
        const imageInput = document.getElementById('file-input');
            if (imageInput.files.length > 0) {
                formData.append('file-input', imageInput.files[0]);
            }

        // CSRF 토큰을 가져옵니다.
        const csrfToken = getCsrfToken();

        axios.post('{% url 'api_signup' %}', formData, {
            headers: {
                'X-CSRFToken': csrfToken
            }
        })
        .then(response => {
            alert('회원가입을 성공했습니다!');
            window.location.href = '{% url "login" %}'
        })
        .catch(error => {
            console.error('회원가입에 실패했습니다.', error);
        });
    });

    document.getElementById('file-input').addEventListener('change', function() {
        const fileName = this.files[0] ? this.files[0].name : '선택된 파일 없음';
        document.getElementById('file-name').textContent = fileName;
    });
</script>
{% endblock content %}