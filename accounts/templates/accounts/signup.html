{% extends "base.html" %}

{% block content %}
<h2>회원가입</h2>
<form id="signup-form" method="POST" enctype="multipart/form-data">
    {% csrf_token %}
    <label for="username">사용자 이름:</label>
    <input type="text" id="username" name="username" required>
    
    <label for="password">비밀번호:</label>
    <input type="password" id="password" name="password" required>
    
    <label for="email">이메일:</label>
    <input type="email" id="email" name="email" required>
    
    <label for="image">프로필 사진:</label>
    <input type="file" id="image" name="image">
    
    <button type="submit">회원가입</button>
</form>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('signup-form').addEventListener('submit', async function(event) {
            event.preventDefault();
            
            const formData = new FormData();
            formData.append('username', document.getElementById('username').value);
            formData.append('password', document.getElementById('password').value);
            formData.append('email', document.getElementById('email').value);

            const imageInput = document.getElementById('image');
            if (imageInput.files.length > 0) {
                formData.append('image', imageInput.files[0]);
            }
            
            const csrfToken = getCookie('csrftoken');

            try {
                const response = await axios.post("{% url 'api_signup' %}", formData, {
                    headers: {
                        'Content-Type': 'multipart/form-data',
                        'X-CSRFToken': csrfToken
                    }
                });
                alert('회원가입이 성공적으로 완료되었습니다.');
                document.getElementById('signup-form').reset(); // 폼 초기화
            } catch (error) {
                console.error('회원가입 실패:', error);
                alert('회원가입에 실패했습니다.');
            }
        });
    });
</script>
{% endblock content %}