{% extends "base.html" %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static "posts/css/detail.css" %}">
<div class="post">
    <h1 id="post-title">한 번 들으면 계속 생각나는 노래;;</h1>
    <div class="author-create">
        <p id="post-created">작성일 | 24.2.24 </p>
        <p id="post-author">작성자 | 나는 승주</p>
    </div>
    <a href="" id="update-link">수정하기 | 편집됨</a>
    <div class="post-img">
        <img src="{% static "posts/css/potato.png" %}" alt="게시글 이미지">
    </div>
    <p id="post-content">
        두 세번 들으면 바로 중독 됨;; 미니언즈 바나나송이랑 고래가 새우를 삼켜버렸다임 이거 듣다 보면 하루종일 고래가~ 새우를~ 이러고 있음ㅋㅋㅋㅋ;;
        한창 듣고 현타올 때 쯤이면 내가 같이 올린 짤을 생각하기 바라... "정신차려라 감자녀석!!!!"
    </p>
    <div class="count">
        <p id="post-likes">좋아요 224</p>
        <p id="post-comment">댓글 224</p>
    </div>
    <form id="comment-form">
        <textarea id="comment-content" rows="4" cols="50" placeholder="댓글을 작성해주세요"></textarea><br>
        <button type="submit">완료</button>
    </form>
    
    <div class="comment-list">
        <div class="comment">
            <img id="img" src="{% static "posts/css/우엥우엥.png" %}" alt="프사">
            <div class="comment-content">
                <p>nickname</p>
                <p id="post-text">내용내용내용내용내용내용내용내용내용내용</p>
                <p>작성일 | 24.2.24 </p> 
            </div>
            <div class="comment-button">
                <button>수정 | 편집됨</button>
                <button>삭제</button>
            </div>
        </div>
    </div>
</div>



<script>
    const postId = /* post_id를 동적으로 설정 */;

    document.addEventListener('DOMContentLoaded', async function() {
        try {
            // 게시물 데이터를 불러오기
            const response = await axios.get(`/api/posts/${postId}/`);
            const post = response.data;
            
            document.getElementById('post-title').innerText = post.title;
            document.getElementById('post-content').innerText = post.content;
            document.getElementById('post-author').innerText = `작성자: ${post.user}`;
            document.getElementById('post-likes').innerText = `좋아요: ${post.like}`;
            document.getElementById('post-created').innerText = `작성일: ${post.created_at}`;
            document.getElementById('post-updated').innerText = `수정일: ${post.updated_at}`;

            const commentsList = document.getElementById('comments-list');
            post.comments.forEach(comment => {
                const commentItem = document.createElement('li');
                commentItem.innerHTML = `
                    <p>${comment.content}</p>
                    <p>작성자: ${comment.user} | 작성일: ${comment.created_at} | 수정일: ${comment.updated_at}</p>
                    <button onclick="editComment(${comment.id})">수정</button>
                    <button onclick="deleteComment(${comment.id})">삭제</button>
                `;
                commentsList.appendChild(commentItem);
            });
        } catch (error) {
            console.error('게시물 데이터를 가져오는 중 오류 발생:', error);
        }

        // 댓글 작성 폼 제출 처리
        document.getElementById('comment-form').addEventListener('submit', async function(event) {
            event.preventDefault();
            const content = document.getElementById('comment-content').value;

            try {
                await axios.post(`/api/posts/${postId}/comments/`, { content }, {
                    headers: {
                        'X-CSRFToken': csrfToken
                    }
                });
                alert('댓글이 작성되었습니다.');
                location.reload(); // 페이지 새로고침하여 댓글 목록 업데이트
            } catch (error) {
                console.error('댓글 작성 중 오류 발생:', error);
            }
        });
    });

    async function editComment(commentId) {
        // 댓글 수정 로직을 추가하세요
        // 예: 수정할 내용을 입력받는 폼을 표시하고, axios.put을 사용하여 서버에 요청
    }

    async function deleteComment(commentId) {
        if (confirm('이 댓글을 삭제하시겠습니까?')) {
            try {
                await axios.delete(`/api/comments/${commentId}/`, {
                    headers: {
                        'X-CSRFToken': csrfToken
                    }
                });
                alert('댓글이 삭제되었습니다.');
                location.reload(); // 페이지 새로고침하여 댓글 목록 업데이트
            } catch (error) {
                console.error('댓글 삭제 중 오류 발생:', error);
            }
        }
    }
</script>
{% endblock content %}